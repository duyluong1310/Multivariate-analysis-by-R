<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>R Tutorials ‚Äì Code Viewer</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">

  <!-- highlight.js -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/r.min.js"></script>

  <style>
    :root{
      --bg:#f7f7fb;
      --panel:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --brand:#3b82f6;
      --border:#e5e7eb;
      --code-bg:#0b1020;
      --radius:14px;
      --shadow:0 10px 30px rgba(2,6,23,0.08);
    }
    [data-theme="dark"]{
      --bg:#0b1220;
      --panel:#0f172a;
      --text:#e5e7eb;
      --muted:#9aa4b2;
      --brand:#60a5fa;
      --border:#1f2937;
      --code-bg:#0b1020;
      --shadow:0 10px 30px rgba(0,0,0,0.4);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter,system-ui,Arial,Helvetica,sans-serif;
      background:var(--bg);
      color:var(--text);
    }

    /* Layout */
    .app{
      display:grid;
      grid-template-columns:320px 1fr;
      gap:24px;
      padding:24px;
      max-width:1400px;
      margin:0 auto;
    }
    @media (max-width: 960px){
      .app{grid-template-columns:1fr}
      .sidebar{position:static;height:auto}
    }

    /* Sidebar */
    .sidebar{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:18px;
      height:calc(100vh - 48px);
      position:sticky;
      top:24px;
      display:flex;
      flex-direction:column;
      gap:14px;
    }
    .brand{
      display:flex;align-items:center;justify-content:space-between;gap:12px
    }
    .brand h1{
      font-size:18px;margin:0;font-weight:700;letter-spacing:0.2px
    }
    .toggle{
      border:1px solid var(--border);
      background:transparent;color:var(--text);
      padding:8px 10px;border-radius:12px;cursor:pointer;
    }
    .search{
      position:relative
    }
    .search input{
      width:100%;padding:12px 14px 12px 38px;border-radius:12px;
      border:1px solid var(--border);background:transparent;color:var(--text);
      outline:none;
    }
    .search svg{position:absolute;left:12px;top:10px;opacity:.6}
    .list{
      overflow:auto;flex:1;display:flex;flex-direction:column;gap:8px;
      padding-right:6px;
    }
    .item{
      display:flex;gap:10px;align-items:flex-start;
      border:1px solid var(--border);background:var(--panel);
      padding:10px 12px;border-radius:12px;cursor:pointer;
      transition:transform .06s ease, border-color .12s ease;
    }
    .item:hover{transform:translateY(-1px);border-color:var(--brand)}
    .item-title{font-weight:600;font-size:14px;margin:0 0 2px 0}
    .item-sub{font-size:12px;color:var(--muted)}

    /* Viewer */
    .viewer{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:0;
      min-height:60vh;
      display:flex;flex-direction:column;
      overflow:hidden;
    }
    .toolbar{
      display:flex;justify-content:space-between;align-items:center;
      padding:14px 16px;border-bottom:1px solid var(--border);
      backdrop-filter:saturate(140%) blur(6px);
    }
    .title{font-weight:700}
    .actions{display:flex;gap:8px}
    .btn{
      padding:8px 12px;border-radius:10px;border:1px solid var(--border);
      background:transparent;color:var(--text);cursor:pointer;
    }
    .btn.primary{background:var(--brand);border-color:var(--brand);color:#fff}
    .status{font-size:12px;color:var(--muted);padding:0 16px 12px}
    pre{
      margin:0;padding:18px;overflow:auto;background:var(--code-bg);
      border-top:1px solid var(--border);
    }
    code{font-family:"Fira Code", monospace;font-size:14px;line-height:1.55}
    .empty{
      padding:40px;text-align:center;color:var(--muted)
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="brand">
        <h1>R Tutorials</h1>
        <button id="themeToggle" class="toggle" title="Dark/Light">üåì</button>
      </div>

      <div class="search">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M21 21l-4.3-4.3m1.6-5.4a7 7 0 11-14 0 7 7 0 0114 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <input id="searchInput" type="search" placeholder="T√¨m b√†i (v√≠ d·ª•: regression, PCA‚Ä¶)" />
      </div>

      <div id="fileList" class="list"></div>
    </aside>

    <!-- VIEWER -->
    <main class="viewer">
      <div class="toolbar">
        <div class="title" id="fileTitle">Ch·ªçn m·ªôt b√†i ·ªü danh s√°ch b√™n tr√°i</div>
        <div class="actions">
          <a id="rawLink" class="btn" href="#" target="_blank" rel="noopener">Raw</a>
          <button id="copyBtn" class="btn">Copy code</button>
          <button id="downloadBtn" class="btn primary">Download</button>
        </div>
      </div>
      <div id="status" class="status">Ready.</div>
      <pre><code id="code" class="language-r"></code></pre>
      <div id="empty" class="empty">Ch∆∞a c√≥ n·ªôi dung. H√£y nh·∫•p m·ªôt b√†i ƒë·ªÉ xem code.</div>
    </main>
  </div>

  <script>
    // ======= C·∫§U H√åNH REPO =======
    const repoOwner = "your_github_username"; // TODO: ƒë·ªïi
    const repoName  = "your_repo_name";       // TODO: ƒë·ªïi
    const branch    = "main";                  // ho·∫∑c t√™n branch kh√°c

    // ======= DANH S√ÅCH FILE =======
    const files = [
      "R for Canonical Corelation Analysis (CCA).R",
      "R for Cluster Analysis.R",
      "R for Discriminant Analysis.R",
      "R for Factor Analysis of Mixed Data (FAMD).R",
      "R for Logistic Regression.R",
      "R for Multidimensional Scaling (MDS).R",
      "R for Multinomial or Ordinal Logistic Regression.R",
      "R for Multiple Regression.R",
      "R for Multivariate Analysis of Variance (MANOVA).R",
      "R for Principle Compenent Analysis (PCA).R",
      "R for Random Forest or Gradient Boosting.R",
      "R for Support Vector Machines (SVM).R"
    ];

    // ======= THAM CHI·∫æU UI =======
    const fileListEl  = document.getElementById("fileList");
    const searchInput = document.getElementById("searchInput");
    const fileTitle   = document.getElementById("fileTitle");
    const rawLink     = document.getElementById("rawLink");
    const copyBtn     = document.getElementById("copyBtn");
    const downloadBtn = document.getElementById("downloadBtn");
    const codeEl      = document.getElementById("code");
    const statusEl    = document.getElementById("status");
    const emptyEl     = document.getElementById("empty");
    const themeToggle = document.getElementById("themeToggle");

    // ======= THEME (dark/light) =======
    const applyTheme = (t)=>document.documentElement.setAttribute("data-theme", t);
    const savedTheme = localStorage.getItem("theme") || "light";
    applyTheme(savedTheme);
    themeToggle.textContent = savedTheme === "dark" ? "üåû" : "üåì";
    themeToggle.onclick = () => {
      const next = (localStorage.getItem("theme") === "dark") ? "light" : "dark";
      localStorage.setItem("theme", next);
      applyTheme(next);
      themeToggle.textContent = next === "dark" ? "üåû" : "üåì";
    };

    // ======= RENDER LIST + SEARCH =======
    let current = null;
    function renderList(keyword=""){
      fileListEl.innerHTML = "";
      const q = keyword.trim().toLowerCase();
      files
        .filter(f => f.toLowerCase().includes(q))
        .forEach(f => {
          const item = document.createElement("div");
          item.className = "item";
          item.innerHTML = `
            <div>
              <div class="item-title">${f}</div>
              <div class="item-sub">Nh·∫•p ƒë·ªÉ xem m√£ ngu·ªìn</div>
            </div>
          `;
          item.onclick = () => loadFile(f);
          fileListEl.appendChild(item);
        });

      if(!fileListEl.children.length){
        const p = document.createElement("div");
        p.className = "item";
        p.innerHTML = `<div class="item-sub">Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ cho ‚Äú${keyword}‚Äù.</div>`;
        fileListEl.appendChild(p);
      }
    }
    searchInput.addEventListener("input", (e)=>renderList(e.target.value));
    renderList();

    // ======= LOAD FILE & HIGHLIGHT =======
    async function loadFile(filename){
      current = filename;
      emptyEl.style.display = "none";
      codeEl.textContent = "";
      fileTitle.textContent = filename;
      statusEl.textContent = "ƒêang t·∫£i‚Ä¶";
      const url = `https://raw.githubusercontent.com/${repoOwner}/${repoName}/${branch}/${encodeURIComponent(filename)}`;
      rawLink.href = url;

      try{
        const res = await fetch(url, {cache:"no-store"});
        if(!res.ok) throw new Error("Kh√¥ng t·∫£i ƒë∆∞·ª£c file.");
        const code = await res.text();
        codeEl.textContent = code;
        hljs.highlightElement(codeEl);
        statusEl.textContent = "ƒê√£ t·∫£i xong.";
      }catch(err){
        statusEl.textContent = "L·ªói t·∫£i file. Ki·ªÉm tra t√™n repo/branch ho·∫∑c ƒë∆∞·ªùng d·∫´n.";
        codeEl.textContent = `# Error: ${err.message}`;
      }
    }

    // ======= COPY & DOWNLOAD =======
    copyBtn.onclick = async ()=>{
      if(!codeEl.textContent) return;
      try{
        await navigator.clipboard.writeText(codeEl.textContent);
        tempToast("ƒê√£ copy v√†o clipboard!");
      }catch{ tempToast("Kh√¥ng copy ƒë∆∞·ª£c."); }
    };

    downloadBtn.onclick = ()=>{
      if(!current) return;
      const blob = new Blob([codeEl.textContent || ""], {type:"text/plain;charset=utf-8"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = current;
      a.click();
      URL.revokeObjectURL(a.href);
    };

    // ======= TOAST NHANH =======
    function tempToast(msg){
      statusEl.textContent = msg;
      setTimeout(()=>{ statusEl.textContent = current ? "S·∫µn s√†ng." : "Ready."; }, 1800);
    }
  </script>
</body>
</html>
